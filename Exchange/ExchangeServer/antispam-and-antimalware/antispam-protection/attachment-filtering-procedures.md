---
localization_priority: Normal
description: 'Summary: Learn how to configure the Attachment Filter agent in Exchange Server to enable or disable attachment filtering, define the attachments to block and the actions to take on the messages, and to view the attachment filtering settings.'
ms.topic: article
author: msdmaguire
ms.author: dmaguire
ms.assetid: 2ec91cc6-6ade-48ee-88bb-66153874393d
ms.reviewer:
title: Attachment filtering procedures on Edge Transport servers
ms.collection: exchange-server
f1.keywords:
- NOCSH
audience: ITPro
ms.prod: exchange-server-it-pro
manager: serdars

---

# Attachment filtering procedures on Edge Transport servers

Attachment filtering in Exchange Server is provided by the Attachment Filter agent that's available only on Edge Transport servers. Attachment filtering can help prevent files in email messages from entering your organization. You can configure one or more attachment filter entries to filter attachments either by content type or by file name.

## What do you need to know before you begin?

- Estimated time to complete each procedure: 5 minutes.

- You need to be assigned permissions before you can perform this procedure or procedures. To see what permissions you need, see the "Antispam features" entry in the [Antispam and antimalware permissions](../../permissions/feature-permissions/antispam-and-antimalware-permissions.md) and the "Transport agents" entry in the [Mail flow permissions](../../permissions/feature-permissions/mail-flow-permissions.md) topic.

- Configuration changes that you make to attachment filtering on an Edge Transport server are made only to the local computer. If you have multiple Edge Transport servers in your perimeter network, you need to configure attachment filtering on each Edge Transport server separately.

- You can only use PowerShell to perform this procedure. To learn how to open the Exchange Management Shell in your on-premises Exchange organization, see [Open the Exchange Management Shell](/powershell/exchange/open-the-exchange-management-shell).

- For information about keyboard shortcuts that may apply to the procedures in this topic, see [Keyboard shortcuts in the Exchange admin center](../../about-documentation/exchange-admin-center-keyboard-shortcuts.md).

> [!TIP]
> Having problems? Ask for help in the Exchange forums. Visit the forums at: [Exchange Server](https://social.technet.microsoft.com/forums/office/home?category=exchangeserver), [Exchange Online](https://social.technet.microsoft.com/forums/msonline/home?forum=onlineservicesexchange), or [Exchange Online Protection](https://social.technet.microsoft.com/forums/forefront/home?forum=FOPE).

## Use the Exchange Management Shell to enable or disable attachment filtering

When you enable or disable the Attachment Filtering agent, the change takes effect after you restart the Microsoft Exchange Transport service. When you restart the Microsoft Exchange Transport service on an Edge Transport server, mail flow on the server is temporarily interrupted.

To disable attachment filtering, run the following command:

```PowerShell
Disable-TransportAgent "Attachment Filtering Agent"
```

To enable attachment filtering, run the following command:

```PowerShell
Enable-TransportAgent "Attachment Filtering Agent"
```

After you enable or disable attachment filtering, restart the Microsoft Exchange Transport service by running the following command:

```PowerShell
Restart-Service MSExchangeTransport
```

### How do you know this worked?

To verify that you successfully enabled or disabled attachment filtering, run the following command to verify the **Enabled** property value:

```PowerShell
Get-TransportAgent "Attachment Filtering Agent"
```

## Use the Exchange Management Shell to view and find attachment filtering entries
<a name="ViewEntries"> </a>

Attachment filtering entries define the message attachments that you want to keep out of your organization. To view the attachment filtering entries that are used by the Attachment Filtering agent, run the following command:

```PowerShell
Get-AttachmentFilterEntry | Format-Table -Auto Type,Name
```

To find a specific MIME content type entry, use the following syntax:

```PowerShell
Get-AttachmentFilterEntry ContentType:<MIMEContentType>
```

For example, to see if there's a MIME content type entry for JPEG images, run the following command:

```PowerShell
Get-AttachmentFilterEntry ContentType:image/jpeg
```

If you receive the error, `Couldn't find the specified identity.`, then the MIME content type isn't defined in the attachment filtering entries.

To view a specific file name or file name extension entry, use the following syntax:

```PowerShell
Get-AttachmentFilterEntry FileName:<FileName or FileNameExtension>
```

For example, to see if there's a file name extension entry for JPEG attachments, run the following command:

```PowerShell
Get-AttachmentFilterEntry FileName:*.jpg
```

If you receive the error, `Couldn't find the specified identity.`, then the file name or file name extension isn't defined in the attachment filtering entries.

For more information, see [Get-AttachmentFilterEntry](/powershell/module/exchange/get-attachmentfilterentry).

## Use the Exchange Management Shell to add attachment filtering entries
<a name="ViewEntries"> </a>

To add an attachment filtering entry that filters attachments by MIME content type, use the following syntax:

```PowerShell
Add-AttachmentFilterEntry -Name <MIMEContentType> -Type ContentType
```

The following example adds a MIME content type entry that filters JPEG images.

```PowerShell
Add-AttachmentFilterEntry -Name image/jpeg -Type ContentType
```

To add an attachment filtering entry that filters attachments by file name or file name extension, use the following syntax:

```PowerShell
Add-AttachmentFilterEntry -Name <FileName or FileNameExtension> -Type FileName
```

The following example filters attachments that have the .jpg file name extension.

```PowerShell
Add-AttachmentFilterEntry -Name *.jpg -Type FileName
```

For more information, see [Add-AttachmentFilterEntry](/powershell/module/exchange/add-attachmentfilterentry).

### How do you know this worked?

To verify that you successfully added an attachment filtering entry, send a test message that contains the prohibited attachment from an external mailbox to an internal recipient and verify that the message and the attachment are processed as you expect.

## Use the Exchange Management Shell to remove attachment filtering entries
<a name="ViewEntries"> </a>

To remove an attachment filtering entry that filters attachments by MIME content type, use the following syntax:

```PowerShell
Remove-AttachmentFilterEntry ContentType:<ContentType>
```

The following example removes the MIME content type entry for JPEG images.

```PowerShell
Remove-AttachmentFilterEntry ContentType:image/jpeg
```

To remove an attachment filtering entry that filters attachments by file name or file name extension, use the following syntax:

```PowerShell
Remove-AttachmentFilterEntry FileName:<FileName or FileNameExtension>
```

The following example removes the file name entry for the .jpg file name extension.

```PowerShell
Remove-AttachmentFilterEntry FileName:*.jpg
```

For more information, see [Remove-AttachmentFilterEntry](/powershell/module/exchange/remove-attachmentfilterentry).

### How do you know this worked?

To verify that you successfully removed an attachment filtering entry, send a test message that contains the allowed attachment from an external mailbox to an internal recipient, and verify that the message was successfully delivered with the attachment.

## Use the Exchange Management Shell to view the attachment filtering action
<a name="ViewEntries"> </a>

To view the attachment filtering action that's used when a prohibited attachment is detected in a message, run the following command:

```PowerShell
Get-AttachmentFilterListConfig | Format-List Action,AdminMessage,RejectResponse,ExceptionConnectors
```

## Use the Exchange Management Shell to configure the attachment filtering action
<a name="ViewEntries"> </a>

To configure the attachment filtering action that's used when a prohibited attachment is detected in a message, use the following syntax:

```PowerShell
Set-AttachmentFilterListConfig [-Action <Reject | Strip | SilentDelete>] [-RejectResponse "<Message text>"] [-AdminMessage "<Replacement file text>"] [-ExceptionConnectors <ConnectorGUID>]
```

This example makes the following changes to the attachment filtering configuration:

- Reject (block) messages that have prohibited attachments. Note that you can't specify different actions for different types of attachments.

- Use a custom response for rejected messages.

```PowerShell
Set-AttachmentFilterListConfig -Action Reject -RejectResponse "This message contains a prohibited attachment. Your message can't be delivered. Please resend the message without the attachment."
```

For more information, see [Set-AttachmentFilterListConfig](/powershell/module/exchange/set-attachmentfilterlistconfig).

### How do you know this worked?

To verify that you successfully configured the attachment filtering action, send a test message that contains a prohibited attachment from an external mailbox to an internal recipient and verify that the message and the attachment are processed as you expect.