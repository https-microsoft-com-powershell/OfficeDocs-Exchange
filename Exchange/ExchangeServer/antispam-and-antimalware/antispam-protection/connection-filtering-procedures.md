---
localization_priority: Normal
description: 'Summary: Learn how to enable, disable, and configure connection filtering in Exchange Server 2016 and Exchange Server 2019 and how to verify the connection filtering settings.'
ms.topic: article
author: msdmaguire
ms.author: dmaguire
ms.assetid: baebc865-ec3e-48ca-ac48-7aac8b34c003
ms.reviewer:
title: Connection filtering procedures on Edge Transport servers
ms.collection: exchange-server
f1.keywords:
- NOCSH
audience: ITPro
ms.prod: exchange-server-it-pro
manager: serdars

---

# Connection filtering procedures on Edge Transport servers

Connection filtering is an antispam feature that's provided by the Connection Filtering agent, which is available only on Edge Transport servers in Exchange Server. Connection filtering enables the following features:

- IP Block list

- IP Block List providers

- IP Allow list

- IP Allow List providers

Each of these features can be enabled or disabled separately.

For more information about connection filtering, see [Connection filtering on Edge Transport servers](connection-filtering.md).

## What do you need to know before you begin?

- Estimated time to complete each procedure: 5 minutes.

- You need to be assigned permissions before you can perform this procedure or procedures. To see what permissions you need, see the "Antispam features" entry in the [Antispam and antimalware permissions](../../permissions/feature-permissions/antispam-and-antimalware-permissions.md) topic.

- You can only use PowerShell to perform this procedure. To learn how to open the Exchange Management Shell in your on-premises Exchange organization, see [Open the Exchange Management Shell](/powershell/exchange/open-the-exchange-management-shell).

- For information about keyboard shortcuts that may apply to the procedures in this topic, see [Keyboard shortcuts in the Exchange admin center](../../about-documentation/exchange-admin-center-keyboard-shortcuts.md).

> [!TIP]
> Having problems? Ask for help in the Exchange forums. Visit the forums at: [Exchange Server](https://social.technet.microsoft.com/forums/office/home?category=exchangeserver), [Exchange Online](https://social.technet.microsoft.com/forums/msonline/home?forum=onlineservicesexchange), or [Exchange Online Protection](https://social.technet.microsoft.com/forums/forefront/home?forum=FOPE).

## Use the Exchange Management Shell to enable or disable connection filtering

To completely enable or disable connection filtering, you enable or disable the Connection Filtering agent. The change takes effect after you restart the Microsoft Exchange Transport service. When you restart the Microsoft Exchange service on an Edge Transport server, mail flow on the server is temporarily interrupted.

To disable connection filtering, run the following command:

```PowerShell
Disable-TransportAgent "Connection Filtering Agent"
```

To enable connection filtering, run the following command:

```PowerShell
Enable-TransportAgent "Connection Filtering Agent"
```

To make the change take effect, restart the Microsoft Exchange Transport service by running the following command:

```PowerShell
Restart-Service MSExchangeTransport
```

### How do you know this worked?

To verify that you successfully enabled or disabled connection filtering, run the following command to verify the **Enabled** property value.

```PowerShell
Get-TransportAgent "Connection Filtering Agent" | Format-List Enabled
```

## IP Block list procedures

These procedures apply to the IP Block list that you manually configure. They don't apply to IP Block List providers.

Use the **IPBlockListConfig** cmdlets to view and configure how connection filtering uses the IP Block list. Use the **IPBlockListEntry** cmdlets to view and configure the IP addresses in the IP Block list.

### Use the Exchange Management Shell to view the configuration of the IP Block list

To view the configuration of the IP Block list, run the following command:

```PowerShell
Get-IPBlockListConfig | Format-List *Enabled,*Response
```

### Use the Exchange Management Shell to enable or disable the IP Block list

To disable the IP Block list, run the following command:

```PowerShell
Set-IPBlockListConfig -Enabled $false
```

To enable the IP Block list, run the following command:

```PowerShell
Set-IPBlockListConfig -Enabled $true
```

For more information, see [Set-IPBlockListConfig](/powershell/module/exchange/set-ipblocklistconfig).

#### How do you know this worked?

To verify that you successfully enabled or disabled the IP Block list, run the following command to verify the **Enabled** property value.

```PowerShell
Get-IPBlockListConfig | Format-List Enabled
```

### Use the Exchange Management Shell to configure the IP Block list

To configure the IP Block list, use the following syntax:

```PowerShell
Set-IPBlockListConfig [-ExternalMailEnabled <$true | $false>] [-InternalMailEnabled <$true | $false> -MachineEntryRejectionResponse "<Custom response text>"] [-StaticEntryRejectionResponse "<Custom response text>"]
```

This example configures the IP Block list with the following settings:

- The IP Block list filters incoming connections from internal and external mail servers. By default, connections are filtered from external mail servers only (_ExternalMailEnabled_ is set to `$true`, and _InternalMailEnabled_ is set to `$false`). Non-authenticated connections and authenticated connections from external partners are considered external.

- The custom response text for connections that were filtered by IP addresses that were automatically added to the IP Block list by the sender reputation feature of the Protocol Analysis agent is set to the value "Connection from IP address {0} was rejected by sender reputation."

- The custom response text for connections that were filtered by IP addresses that were manually added to the IP Block list is set to the value "Connection from IP address {0} was rejected by connection filtering."

```PowerShell
Set-IPBlockListConfig -InternalMailEnabled $true -MachineEntryRejectionResponse "Connection from IP address {0} was rejected by sender reputation." -StaticEntryRejectionResponse "Connection from IP address {0} was rejected by connection filtering."
```

For more information, see [Set-IPBlockListConfig](/powershell/module/exchange/set-ipblocklistconfig).

#### How do you know this worked?

To verify that you successfully configured the IP Block list, run the following command to verify the property values.

```PowerShell
Get-IPBlockListConfig | Format-List *MailEnabled,*Response
```

### Use the Exchange Management Shell to view IP Block list entries

To view all IP Block list entries, run the following command:

```PowerShell
Get-IPBlockListEntry
```

Note that each IP Block list entry is identified by an integer value. The identity integer is assigned in ascending order when you add entries to the IP Block list and the IP Allow list.

To view a specific IP Block list entry, use the following syntax:

```PowerShell
Get-IPBlockListEntry <-Identity IdentityInteger | -IPAddress IPAddress>
```

For example, to view the IP Block list entry that contains the IP address 192.168.1.13, run the following command:

```PowerShell
Get-IPBlockListEntry -IPAddress 192.168.1.13
```

For more information, see [Get-IPBlockListEntry](/powershell/module/exchange/get-ipblocklistentry).

> [!NOTE]
> When you use the _IPAddress_ parameter, the resulting IP Block list entry can be an individual IP address, an IP address range, or a Classless InterDomain Routing (CIDR) IP. To use the _Identity_ parameter, you specify the integer value that's assigned to the IP Block list entry.

### Use the Exchange Management Shell to add IP Block list entries

To add IP Block list entries, use the following syntax:

```PowerShell
Add-IPBlockListEntry <-IPAddress IPAddress | -IPRange IP range or CIDR IP> [-ExpirationTime <DateTime>] [-Comment "<Descriptive Comment>"]
```

This example adds the IP Block list entry for the IP address range 192.168.1.10 through 192.168.1.15 and configures the IP Block list entry to expire on July 4, 2018 at 15:00.

```PowerShell
Add-IPBlockListEntry -IPRange 192.168.1.10-192.168.1.15 -ExpirationTime "7/4/2018 15:00"
```

For more information, see [Add-IPBlockListEntry](/powershell/module/exchange/add-ipblocklistentry).

#### How do you know this worked?

To verify that you successfully added an IP Block list entry, run the following command and verify that the new IP Block list entry is displayed.

```PowerShell
Get-IPBlockListEntry
```

### Use the Exchange Management Shell to remove IP Block list entries

To remove IP Block list entries, use the following syntax:

```PowerShell
Remove-IPBlockListEntry <IdentityInteger>
```

This example removes the IP Block list entry that has the _Identity_ value 3.

```PowerShell
Remove-IPBlockListEntry 3
```

This example removes the IP Block list entry that contains the IP address 192.168.1.12 without using the _Identity_ integer value. Note that the IP Block list entry can be an individual IP address or an IP address range.

```PowerShell
Get-IPBlockListEntry -IPAddress 192.168.1.12 | Remove-IPBlockListEntry
```

For more information, see [Remove-IPBlockListEntry](/powershell/module/exchange/remove-ipblocklistentry).

#### How do you know this worked?

To verify that you successfully removed an IP Block list entry, run the following command and verify that the IP Block list entry you removed is gone.

```PowerShell
Get-IPBlockListEntry
```

## IP Block List provider procedures

These procedures apply to IP Block List providers. They don't apply to the IP Block list.

Use the **IPBlockListProvidersConfig** cmdlets to view and configure how connection filtering uses all IP Block List providers. Use the **IPBlockListProvider** cmdlets to view, configure, and test IP Block List providers.

### Use the Exchange Management Shell to view the configuration of all IP Block List providers

To view how connection filtering uses all IP Block List providers, run the following command:

```PowerShell
Get-IPBlockListProvidersConfig | Format-List *Enabled,Bypassed*
```

For more information, see [Get-IPBlockListProvidersConfig](/powershell/module/exchange/get-ipblocklistprovidersconfig).

### Use the Exchange Management Shell to enable or disable all IP Block List providers

To disable all IP Block List providers, run the following command:

```PowerShell
Set-IPBlockListProvidersConfig -Enabled $false
```

To enable all IP Block List providers, run the following command:

```PowerShell
Set-IPBlockListProvidersConfig -Enabled $true
```

For more information, see [Set-IPBlockListProvidersConfig](/powershell/module/exchange/set-ipblocklistprovidersconfig).

#### How do you know this worked?

To verify that you enabled or disabled all IP Block List providers, run the following command to verify the value of the **Enabled** property:

```PowerShell
Get-IPBlockListProvidersConfig | Format-List Enabled
```

### Use the Exchange Management Shell to configure all IP Block List providers

To configure how connection filtering uses all IP Block List providers, use the following syntax:

```PowerShell
Set-IPBlockListProvidersConfig [-BypassedRecipients <recipient1,recipient2...>] [-ExternalMailEnabled <$true | $false>] [-InternalMailEnabled <$true | $false>]
```

This example configures all IP Block List providers with the following settings:

- IP Block List providers filter incoming connections from internal and external mail servers. By default, connections are filtered from external mail servers only (_ExternalMailEnabled_ is set to `$true`, and _InternalMailEnabled_ is set to `$false`). Non-authenticated connections and authenticated connections from external partners are considered external.

- Messages sent to the internal recipients chris@fabrikam.com and michelle@fabrikam.com are excluded from filtering by IP Block List providers. Note that if you want to add recipients to the list without affecting existing recipients, use the syntax, `@{Add="<recipient1>","<recipient2>"...}`.

```PowerShell
Set-IPBlockListProvidersConfig -BypassedRecipients chris@fabrikam.com,michelle@fabrikam.com -InternalMailEnabled $true
```

For more information, see [Set-IPBlockListProvidersConfig](/powershell/module/exchange/set-ipblocklistprovidersconfig).

#### How do you know this worked?

To verify that you successfully configured all IP Block List providers, run the following command to verify the property values:

```PowerShell
Get-IPBlockListProvidersConfig | Format-List *MailEnabled,Bypassed*
```

### Use the Exchange Management Shell to view IP Block List providers

To view the summary list of all the IP Block List providers, run the following command:

```PowerShell
Get-IPBlockListProvider
```

To view the details of a specific provider, use the following syntax:

```PowerShell
Get-IPBlockListProvider <IPBlockListProviderIdentity>
```

This example show the details of the provider named Contoso IP Block List Provider.

```PowerShell
Get-IPBlockListProvider "Contoso IP Block List Provider" | Format-List Name,Enabled,Priority,LookupDomain,*Match,*Response
```

For more information, see [Get-IPBlockListProvider](/powershell/module/exchange/get-ipblocklistprovider).

### Use the Exchange Management Shell to add an IP Block List provider

To add an IP Block List provider, use the following syntax:

```PowerShell
Add-IPBlockListProvider -Name "<Descriptive Name>" -LookupDomain <FQDN> [-Priority <Integer>] [-Enabled <$true | $false>] [-AnyMatch <$true | $false>] [-BitmaskMatch <IPAddress>] [-IPAddressesMatch <IPAddressStatusCode1,IPAddressStatusCode2...>] [-RejectionResponse "<Custom Text>"]
```

This example creates an IP Block List provider named "Contoso IP Block List Provider" with the following options:

- **FQDN to use the provider**: rbl.contoso.com

- **Bitmask code to use from the provider**: 127.0.0.1

```PowerShell
Add-IPBlockListProvider -Name "Contoso IP Block List Provider" -LookupDomain rbl.contoso.com -BitmaskMatch 127.0.0.1
```

> [!NOTE]
> When you add a new IP Block List provider, it's enabled by default (the value of _Enabled_ is `$true`), and the priority value is incremented (the first entry has the _Priority_ value 1).

For more information, see [Add-IPBlockListProvider](/powershell/module/exchange/add-ipblocklistprovider).

#### How do you know this worked?

To verify that you successfully added an IP Block List provider, run the following command and verify that the new IP Block List provider is displayed.

```PowerShell
Get-IPBlockListProvider
```

### Use the Exchange Management Shell to enable or disable an IP Block List provider

To enable or disable a specific IP Block List provider, use the following syntax:

```PowerShell
Set-IPBlockListProvider <IPBlockListProviderIdentity> -Enabled <$true | $false>
```

This example disables the provider named Contoso IP Block List Provider.

```PowerShell
Set-IPBlockListProvider "Contoso IP Block List Provider" -Enabled $false
```

This example enables the provider named Contoso IP Block List Provider.

```PowerShell
Set-IPBlockListProvider "Contoso IP Block List Provider" -Enabled $true
```

For more information, see [Set-IPBlockListProvider](/powershell/module/exchange/set-ipblocklistprovider).

#### How do you know this worked?

To verify that you successfully enabled or disabled an IP Block List provider, run the following command to verify the value of the **Enabled** property:

```PowerShell
Get-IPBlockListProvider | Format-Table -Auto Name,LookupDomain,Priority,Enabled
```

### Use the Exchange Management Shell to configure an IP Block List provider

The configuration options that are available on the **Set-IPBlockListProvider** cmdlet are identical to those on the **Add-IPBlockListProvider** cmdlet.

To configure an existing IP Block List provider, use the following syntax:

```PowerShell
Set-IPBlockListProvider <IPBlockListProviderIdentity> -Name "<Descriptive Name>" -LookupDomain <FQDN> [-Priority <Integer>] [-AnyMatch <$true | $false>] [-BitmaskMatch <IPAddress>] [-IPAddressesMatch <IPAddressStatusCode1,IPAddressStatusCode2...>] [-RejectionResponse "<Custom Text>"]
```

For example, to add the IP address status code 127.0.0.1 to the list of existing status codes for the provider named Contoso IP Block List Provider, run the following command:

```PowerShell
Set-IPBlockListProvider "Contoso IP Block List Provider" -IPAddressesMatch @{Add="127.0.0.1"}
```

For more information, see [Set-IPBlockListProvider](/powershell/module/exchange/set-ipblocklistprovider).

#### How do you know this worked?

To verify that you successfully configured an IP Block List provider, run the following command to verify the property values. Be sure to replace _\<IPBlockListProviderIdentity\>_ with the name of the IP Block List provider.

```PowerShell
Get-IPBlockListProvider <IPBlockListProviderIdentity> | Format-List
```

### Use the Exchange Management Shell to test an IP Block List provider

To test an IP Block List provider, use the following syntax:

```PowerShell
Test-IPBlockListProvider <IPBlockListProviderIdentity> -IPAddress <IPAddressToTest>
```

This example tests the provider named Contoso IP Block List Provider by looking up the IP address 192.168.1.1.

```PowerShell
Test-IPBlockListProvider "Contoso IP Block List Provider" -IPAddress 192.168.1.1
```

For more information, see [Test-IPBlockListProvider](/powershell/module/exchange/test-ipblocklistprovider).

### Use the Exchange Management Shell to remove an IP Block List provider

To remove an IP Block List provider, use the following syntax:

```PowerShell
Remove-IPBlockListProvider <IPBlockListProviderIdentity>
```

This example removes the IP Block List provider named Contoso IP Block List Provider.

```PowerShell
Remove-IPBlockListProvider "Contoso IP Block list Provider"
```

For more information, see [Remove-IPBlockListProvider](/powershell/module/exchange/remove-ipblocklistprovider).

#### How do you know this worked?

To verify that you successfully removed an IP Block List provider, run the following command and verify that the IP Block List provider you removed is gone.

```PowerShell
Get-IPBlockListProvider
```

## IP Allow list procedures

These procedures apply to the IP Allow list that you manually configure. They don't apply to IP Allow List providers.

Use the **IPAllowListConfig** cmdlets to view and configure how connection filtering uses the IP Allow list. Use the **IPAllowListEntry** cmdlets to view and configure the IP addresses in the IP Allow list.

### Use the Exchange Management Shell to view the configuration of the IP Allow list

To view the configuration of the IP Allow list, run the following command.

```PowerShell
Get-IPAllowListConfig | Format-List *Enabled
```

For more information, see [Get-IPAllowListConfig](/powershell/module/exchange/get-ipallowlistconfig).

### Use the Exchange Management Shell to enable or disable the IP Allow list

To disable the IP Allow list, run the following command:

```PowerShell
Set-IPAllowListConfig -Enabled $false
```

To enable the IP Allow list, run the following command:

```PowerShell
Set-IPAllowListConfig -Enabled $true
```

#### How do you know this worked?

To verify that you successfully enabled or disabled the IP Allow list, run the following command to verify the value of the **Enabled** property:

```PowerShell
Get-IPAllowListConfig | Format-List Enabled
```

### Use the Exchange Management Shell to configure the IP Allow list

To configure the IP Allow list, use the following syntax:

```PowerShell
Set-IPAllowListConfig [-ExternalMailEnabled <$true | $false>] [-InternalMailEnabled <$true | $false>
```

This example configures the IP Allow list to filter incoming connections from internal and external mail servers. By default, connections are filtered from external mail servers only (_ExternalMailEnabled_ is set to `$true`, and _InternalMailEnabled_ is set to `$false`). Non-authenticated connections and authenticated connections from external partners are considered external.

```PowerShell
Set-IPAllowListConfig -InternalMailEnabled $true
```

For more information, see [Set-IPAllowListConfig](/powershell/module/exchange/set-ipallowlistconfig).

#### How do you know this worked?

To verify that you successfully configured the IP Allow list, run the following command to verify the property values:

```PowerShell
Get-IPAllowListConfig | Format-List *MailEnabled
```

### Use the Exchange Management Shell to view IP Allow list entries

To view all IP Allow list entries, run the following command:

```PowerShell
Get-IPAllowListEntry
```

Note that each IP Allow list entry is identified by an integer value. The identity integer is assigned in ascending order when you add entries to the IP Block list and the IP Allow list.

To view a specific IP Allow list entry, use the following syntax:

```PowerShell
Get-IPAllowListEntry <-Identity IdentityInteger | -IPAddress IPAddress>
```

For example, to view the IP Allow list entry that contains the IP address 192.168.1.13, run the following command:

```PowerShell
Get-IPAllowListEntry -IPAddress 192.168.1.13
```

For more information, see [Get-IPAllowListEntry](/powershell/module/exchange/get-ipallowlistentry).

> [!NOTE]
> When you use the _IPAddress_ parameter, the resulting IP Allow list entry can be an individual IP address, an IP address range, or a Classless InterDomain Routing (CIDR) IP. To use the _Identity_ parameter, you specify the integer value that's assigned to the IP Allow list entry.

### Use the Exchange Management Shell to add IP Allow list entries

To add IP Allow list entries, use the following syntax:

```PowerShell
Add-IPAllowListEntry <-IPAddress IPAddress | -IPRange IP range or CIDR IP> [-ExpirationTime <DateTime>] [-Comment "<Descriptive Comment>"]
```

This example adds the IP Allow list entry for the IP address range 192.168.1.10 through 192.168.1.15 and configures the IP Allow list entry to expire on July 4, 2018 at 15:00.

```PowerShell
Add-IPAllowListEntry -IPRange 192.168.1.10-192.168.1.15 -ExpirationTime "7/4/2018 15:00"
```

For more information, see [Add-IPAllowListEntry](/powershell/module/exchange/add-ipallowlistentry).

#### How do you know this worked?

To verify that you successfully added an IP Allow list entry, run the following command and verify that the new IP Allow list entry is displayed.

```PowerShell
Get-IPAllowListEntry
```

### Use the Exchange Management Shell to remove IP Allow list entries

To remove IP Allow list entries, use the following syntax:

```PowerShell
Remove-IPAllowListEntry <IdentityInteger>
```

This example removes the IP Allow list entry that has the _Identity_ value 3.

```PowerShell
Remove-IPAllowListEntry 3
```

This example removes the IP Allow list entry that contains the IP address 192.168.1.12 without using the _Identity_ integer value. Note that the IP Allow list entry can be an individual IP address or an IP address range.

```PowerShell
Get-IPAllowListEntry -IPAddress 192.168.1.12 | Remove-IPAllowListEntry
```

For more information, see [Remove-IPAllowListEntry](/powershell/module/exchange/remove-ipallowlistentry).

#### How do you know this worked?

To verify that you successfully removed an IP Allow list entry, run the following command and verify that the IP Allow list entry you removed is gone.

```PowerShell
Get-IPAllowListEntry
```

## IP Allow List provider procedures

These procedures apply to IP Allow List providers. They don't apply to the IP Allow list.

Use the **IPAllowListProvidersConfig** cmdlets to view and configure how connection filtering uses all IP Allow List providers. Use the **IPAllowListProvider** cmdlets to view, configure, and test IP Allow List providers.

### Use the Exchange Management Shell to view the configuration of all IP Allow List providers

To view how connection filtering uses all IP Allow List providers, run the following command:

```PowerShell
Get-IPAllowListProvidersConfig | Format-List *Enabled
```

For more information, see [Get-IPAllowListProvidersConfig](/powershell/module/exchange/get-ipallowlistprovidersconfig).

### Use the Exchange Management Shell to enable or disable all IP Allow List providers

To disable all IP Allow List providers, run the following command:

```PowerShell
Set-IPAllowListProvidersConfig -Enabled $false
```

To enable all IP Allow List providers, run the following command:

```PowerShell
Set-IPAllowListProvidersConfig -Enabled $true
```

For more information, see [Set-IPAllowListProvidersConfig](/powershell/module/exchange/set-ipallowlistprovidersconfig).

#### How do you know this worked?

To verify that you enabled or disabled all IP Allow List providers, run the following command to verify the **Enabled** property value:

```PowerShell
Get-IPAllowListProvidersConfig | Format-List Enabled
```

### Use the Exchange Management Shell to configure all IP Allow List providers

To configure how connection filtering uses all IP Allow List providers, use the following syntax:

```PowerShell
Set-IPAllowListProvidersConfig [-ExternalMailEnabled <$true | $false>] [-InternalMailEnabled <$true | $false>]
```

This example configures all IP Allow List providers to filter incoming connections from internal and external mail servers. By default, connections are filtered from external mail servers only (_ExternalMailEnabled_ is set to `$true`, and _InternalMailEnabled_ is set to `$false`). Non-authenticated connections and authenticated connections from external partners are considered external.

```PowerShell
Set-IPAllowListProvidersConfig -InternalMailEnabled $true
```

For more information, see [Set-IPAllowListProvidersConfig](/powershell/module/exchange/set-ipblocklistprovidersconfig).

#### How do you know this worked?

To verify that you successfully configured all IP Allow List providers, run the following command to verify the property values:

```PowerShell
Get-IPAllowListProvidersConfig | Format-List *MailEnabled
```

### Use the Exchange Management Shell to view IP Allow List providers

To view the summary list of all the IP Allow List providers, run the following command.

```PowerShell
Get-IPAllowListProvider
```

To view the details of a specific provider, use the following syntax:

```PowerShell
Get-IPAllowListProvider <IPAllowListProviderIdentity>
```

This example show the details of the provider named Contoso IP Allow List Provider.

```PowerShell
Get-IPAllowListProvider "Contoso IP Allow List Provider" | Format-List Name,Enabled,Priority,LookupDomain,*Match
```

For more information, see [Get-IPAllowListProvider](/powershell/module/exchange/get-ipallowlistprovider).

### Use the Exchange Management Shell to add an IP Allow List provider

To add an IP Allow List provider, use the following syntax:

```PowerShell
Add-IPAllowListProvider -Name "<Descriptive Name>" -LookupDomain <FQDN> [-Priority <Integer>] [-Enabled <$true | $false>] [-AnyMatch <$true | $false>] [-BitmaskMatch <IPAddress>] [-IPAddressesMatch <IPAddressStatusCode1,IPAddressStatusCode2...>]
```

This example creates an IP Allow List provider named "Contoso IP Allow List Provider" with the following options:

- **FQDN to use the provider**: allow.contoso.com

- **Bitmask code to use from the provider**: 127.0.0.1

```PowerShell
Add-IPAllowListProvider -Name "Contoso IP Allow List Provider" -LookupDomain allow.contoso.com -BitmaskMatch 127.0.0.1
```

> [!NOTE]
> When you add a new IP Allow List provider, it's enabled by default (the value of _Enabled_ is `$true`), and the priority value is incremented (the first entry has the _Priority_ value 1).

For more information, see [Add-IPAllowListProvider](/powershell/module/exchange/add-ipblocklistprovider).

#### How do you know this worked?

To verify that you successfully added an IP Allow List provider, run the following command and verify that the new IP Allow List provider is displayed.

```PowerShell
Get-IPAllowListProvider
```

### Use the Exchange Management Shell to enable or disable an IP Allow List provider

To enable or disable a specific IP Allow List provider, use the following syntax:

```PowerShell
Set-IPAllowListProvider <IPAllowListProviderIdentity> -Enabled <$true | $false>
```

This example disables the provider named Contoso IP Allow List Provider.

```PowerShell
Set-IPAllowListProvider "Contoso IP Allow List Provider" -Enabled $false
```

This example enables the provider named Contoso IP Allow List Provider.

```PowerShell
Set-IPAllowListProvider "Contoso IP Allow List Provider" -Enabled $true
```

For more information, see [Set-IPAllowListProvider](/powershell/module/exchange/set-ipblocklistprovider).

#### How do you know this worked?

To verify that you successfully enabled or disabled an IP Allow List provider, run the following command to verify the **Enabled** property value:

```PowerShell
Get-IPAllowListProvider | Format-Table -Auto Name,LookupDomain,Priority,Enabled
```

### Use the Exchange Management Shell to configure an IP Allow List provider

The configuration options that are available on the **Set-IPAllowListProvider** cmdlet are identical to those on the **Add-IPAllowListProvider** cmdlet.

To configure an existing IP Allow List provider, use the following syntax:

```PowerShell
Set-IPAllowListProvider <IPAllowListProviderIdentity> -Name "<Descriptive Name>" -LookupDomain <FQDN> [-Priority <Integer>] [-AnyMatch <$true | $false>] [-BitmaskMatch <IPAddress>] [-IPAddressesMatch <IPAddressStatusCode1,IPAddressStatusCode2...>]
```

For example, to add the IP address status code 127.0.0.1 to the list of existing status codes for the provider named Contoso IP Allow List Provider, run the following command:

```PowerShell
Set-IPAllowListProvider "Contoso IP Allow List Provider" -IPAddressesMatch @{Add="127.0.0.1"}
```

For more information, see [Set-IPAllowListProvider](/powershell/module/exchange/set-ipblocklistprovider).

#### How do you know this worked?

To verify that you successfully configured an IP Allow List provider, run the following command. Be sure to replace _\<IPAllowListProviderIdentity\>_ with the name of the IP Allow List provider.

```PowerShell
Get-IPAllowListProvider <IPAllowListProviderIdentity> | Format-List
```

### Use the Exchange Management Shell to test an IP Allow List provider

To test an IP Allow List provider, use the following syntax:

```PowerShell
Test-IPAllowListProvider <IPAllowListProviderIdentity> -IPAddress <IPAddressToTest>
```

This example tests the provider named Contoso IP Allow List Provider by looking up the IP address 192.168.1.1.

```PowerShell
Test-IPAllowListProvider "Contoso IP Allow List Provider" -IPAddress 192.168.1.1
```

For more information, see [Test-IPAllowListProvider](/powershell/module/exchange/test-ipallowlistprovider).

### Use the Exchange Management Shell to remove an IP Allow List provider

To remove an IP Allow List provider, use the following syntax:

```PowerShell
Remove-IPAllowListProvider <IPAllowListProviderIdentity>
```

This example removes the IP Allow List provider named Contoso IP Allow List Provider.

```PowerShell
Remove-IPAllowListProvider "Contoso IP Allow List Provider"
```

For more information, see [Remove-IPAllowListProvider](/powershell/module/exchange/remove-ipallowlistprovider).

#### How do you know this worked?

To verify that you successfully removed an IP Allow List provider, run the following command and verify that the IP Allow List provider you removed is gone.

```PowerShell
Get-IPAllowListProvider
```